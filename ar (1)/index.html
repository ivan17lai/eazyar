<!doctype html>
<html>
    <head>
        <script src="https://aframe.io/releases/1.0.4/aframe.min.js"></script>
        <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
        <script>
            AFRAME.registerComponent('videohandler', {
                init: function () {
                    var marker = this.el;
                    this.vid = document.getElementById("videoCanvas");

                    marker.addEventListener('markerFound', function () {
                        this.toggle = true;
                        this.vid.play();
                    }.bind(this));

                    marker.addEventListener('markerLost', function () {
                        this.toggle = false;
                        this.vid.pause();
                    }.bind(this));
                },
            });

            window.onload = function () {
                var canvas = document.getElementById("videoCanvas");
                var ctx = canvas.getContext("2d");
                var video = document.getElementById("videoElement");

                video.play();
                video.addEventListener('play', function () {
                    var $this = this; // cache
                    (function loop() {
                        if (!$this.paused && !$this.ended) {
                            ctx.drawImage($this, 0, 0, canvas.width, canvas.height);
                            setTimeout(loop, 1000 / 30); // draw at 30fps
                        }
                    })();
                }, 0);
            }
        </script>
    </head>

    <body style="margin: 0; overflow: hidden;">
        <a-scene
            vr-mode-ui="enabled: false"
            loading-screen="enabled: false;"
            arjs='sourceType: webcam; debugUIEnabled: false;'
            embedded
        >
            <a-assets>
                <!-- 隱藏的影片元素 -->
                <video id="videoElement" src="https://www.w3schools.com/html/mov_bbb.mp4" preload="auto" crossorigin="anonymous" webkit-playsinline playsinline></video>
            </a-assets>

            <!-- 用來繪製影片的 Canvas -->
            <canvas id="videoCanvas" width="640" height="360" style="display: none;"></canvas>

            <a-marker
                preset="hiro"
                videohandler
            >
                <!-- 平面用來顯示影片 -->
                <a-plane 
                    position="0 0.5 0" 
                    rotation="-90 0 0" 
                    width="1" 
                    height="0.56" 
                    material="shader: canvas; src: #videoCanvas">
                </a-plane>
            </a-marker>

            <a-entity camera></a-entity>
        </a-scene>
    </body>
</html>
